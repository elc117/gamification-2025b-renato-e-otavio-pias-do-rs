@startuml Vis√£o Geral - Fact or Fake

title Arquitetura Completa do Sistema (Vis√£o Simplificada)

' ==========================
' CONFIGURA√á√ïES DE ESTILO
' ==========================
skinparam packageStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam linetype ortho

' ==========================
' CAMADAS DA ARQUITETURA
' ==========================

package "üü¢ Controller Layer\n(API REST)" <<Rectangle>> #E8F5E9 {
    [AuthController]
    [UsuarioController]
    [CategoriaController]
    [NoticiaController]
    [ConquistaController]
    [RecompensaController]
}

package "üü° Service Layer\n(L√≥gica de Neg√≥cio)" <<Rectangle>> #FFF9C4 {
    [JogoService]
    [RecompensaService]
}

package "üü£ Repository Layer\n(Acesso a Dados)" <<Rectangle>> #F3E5F5 {
    [GenericRepository<T>]
    [UsuarioRepository]
    [CategoriaRepository]
    [NoticiaRepository]
    [RespostaRepository]
    [ProgressoCategoriaRepository]
    [ConquistaRepository]
    [ConquistaUsuarioRepository]
    [PecaRecompensaRepository]
    [PecaUsuarioRepository]
}

package "üîµ Model Layer\n(Entidades JPA)" <<Rectangle>> #E1F5FE {
    [Usuario]
    [Categoria]
    [Noticia]
    [Resposta]
    [ProgressoCategoria]
    [Conquista]
    [ConquistaUsuario]
    [PecaRecompensa]
    [PecaUsuario]
}

database "üóÑÔ∏è PostgreSQL\n(Banco de Dados)" <<Database>> {
    folder "Tabelas" {
        [usuarios]
        [categorias]
        [noticias]
        [respostas]
        [progresso_categoria]
        [conquistas]
        [conquistas_usuario]
        [pecas_recompensa]
        [pecas_usuario]
        [pecas_desbloqueadas]
    }
}

' ==========================
' RELACIONAMENTOS ENTRE CAMADAS
' ==========================

' Controllers ‚Üí Services
[NoticiaController] --> [JogoService]
[RecompensaController] --> [RecompensaService]

' Controllers ‚Üí Repositories
[AuthController] --> [UsuarioRepository]
[UsuarioController] --> [UsuarioRepository]
[CategoriaController] --> [CategoriaRepository]
[ConquistaController] --> [ConquistaRepository]

' Services ‚Üí Repositories
[JogoService] --> [NoticiaRepository]
[JogoService] --> [RespostaRepository]
[JogoService] --> [UsuarioRepository]
[JogoService] --> [ProgressoCategoriaRepository]

[RecompensaService] --> [ProgressoCategoriaRepository]
[RecompensaService] --> [PecaRecompensaRepository]
[RecompensaService] --> [RespostaRepository]

' Repositories ‚Üí Model
[UsuarioRepository] ..> [Usuario]
[CategoriaRepository] ..> [Categoria]
[NoticiaRepository] ..> [Noticia]
[RespostaRepository] ..> [Resposta]
[ProgressoCategoriaRepository] ..> [ProgressoCategoria]

' Model ‚Üí Database
[Usuario] ..> [usuarios]
[Categoria] ..> [categorias]
[Noticia] ..> [noticias]
[Resposta] ..> [respostas]
[ProgressoCategoria] ..> [progresso_categoria]
[Conquista] ..> [conquistas]
[ConquistaUsuario] ..> [conquistas_usuario]
[PecaRecompensa] ..> [pecas_recompensa]
[PecaUsuario] ..> [pecas_usuario]

' ==========================
' NOTAS EXPLICATIVAS
' ==========================

note top of "üü¢ Controller Layer\n(API REST)"
    <b>Camada de Apresenta√ß√£o</b>

    Define rotas HTTP REST
    Gerencia sess√µes de usu√°rio
    Valida requisi√ß√µes
    Retorna JSON
end note

note top of "üü° Service Layer\n(L√≥gica de Neg√≥cio)"
    <b>L√≥gica Central</b>

    JogoService:
    - Seleciona not√≠cias
    - Processa respostas
    - Calcula pontos e n√≠veis

    RecompensaService:
    - Desbloqueia pe√ßas visuais
    - Calcula progresso (25%, 50%, 75%, 100%)
end note

note top of "üü£ Repository Layer\n(Acesso a Dados)"
    <b>Persist√™ncia</b>

    Usa Hibernate SessionFactory
    CRUD gen√©rico via GenericRepository<T>
    Queries espec√≠ficas por reposit√≥rio
end note

note top of "üîµ Model Layer\n(Entidades JPA)"
    <b>Dom√≠nio</b>

    Entidades mapeadas com @Entity
    Relacionamentos JPA (@ManyToOne, etc)
    Representam tabelas do banco
end note

note right of "üóÑÔ∏è PostgreSQL\n(Banco de Dados)"
    <b>Banco de Dados</b>

    PostgreSQL local (desenvolvimento)
    Gerenciado via Flyway migrations
    Conex√£o: localhost:5432
    Database: fact_or_fake
end note

' ==========================
' FLUXO DE UMA REQUISI√á√ÉO
' ==========================

note bottom of "üü¢ Controller Layer\n(API REST)"
    <b>üìä Fluxo de Requisi√ß√£o (Exemplo: Responder Not√≠cia)</b>

    1. <b>Frontend</b> ‚Üí POST /noticias/1/responder { "resposta": true }
    2. <b>NoticiaController</b> ‚Üí valida sess√£o do usu√°rio
    3. <b>JogoService</b> ‚Üí processarResposta(usuarioId, noticiaId, resposta)
    4. <b>RespostaRepository</b> ‚Üí salva resposta no banco
    5. <b>UsuarioRepository</b> ‚Üí atualiza pontua√ß√£o e n√≠vel
    6. <b>RecompensaService</b> ‚Üí verifica se desbloqueou pe√ßas
    7. <b>Controller</b> ‚Üí retorna JSON com resultado + explica√ß√£o
    8. <b>Frontend</b> ‚Üí exibe feedback ao usu√°rio
end note

@enduml
@startuml Diagrama de Entidades - Fact or Fake

title Camada de Modelo (Entidades)

' ==========================
' CONFIGURA√á√ïES DE ESTILO
' ==========================
skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam linetype ortho

skinparam class {
    BackgroundColor #E1F5FE
    BorderColor #0277BD
}

' ==========================
' ENTIDADES DO DOM√çNIO
' ==========================

class Usuario {
    - id: Long
    - nome: String
    - email: String
    - nivel: int
    - pontuacaoTotal: int
    - tituloAtual: String
    - totalTentativas: int
    - acertosTotais: int
    - taxaAcerto: double
    --
    + getId(): Long
    + getNome(): String
    + getEmail(): String
    + getNivel(): int
    + getPontuacaoTotal(): int
    + getTituloAtual(): String
}

class Categoria {
    - id: Long
    - nome: String
    - descricao: String
    - totalNiveis: int
    - caminhoImagemCompleta: String
    --
    + getId(): Long
    + getNome(): String
    + getDescricao(): String
    + getCaminhoImagemCompleta(): String
}

class Noticia {
    - id: Long
    - categoriaId: Long
    - titulo: String
    - conteudo: String
    - ehVerdadeira: boolean
    - explicacao: String
    --
    + getId(): Long
    + getTitulo(): String
    + getConteudo(): String
    + isEhVerdadeira(): boolean
    + getExplicacao(): String
}

class Resposta {
    - id: Long
    - usuarioId: Long
    - noticiaId: Long
    - respostaUsuario: boolean
    - estaCorreta: boolean
    - pontosGanhos: int
    - tentativas: int
    --
    + getId(): Long
    + isRespostaUsuario(): boolean
    + isEstaCorreta(): boolean
    + getPontosGanhos(): int
    + getTentativas(): int
}

class ProgressoCategoria {
    - id: Long
    - usuarioId: Long
    - categoriaId: Long
    - nivelAtual: int
    - pontosMaestria: int
    - totalTentativas: int
    - pecasDesbloqueadas: List<Integer>
    --
    + getId(): Long
    + getNivelAtual(): int
    + getPontosMaestria(): int
    + getPecasDesbloqueadas(): List<Integer>
}

class Conquista {
    - id: Long
    - nome: String
    - descricao: String
    - criterio: String
    - tipo: String
    - valorRequerido: int
    --
    + getId(): Long
    + getNome(): String
    + getDescricao(): String
    + getCriterio(): String
    + getValorRequerido(): int
}

class ConquistaUsuario {
    - id: Long
    - usuarioId: Long
    - conquistaId: Long
    - dataDesbloqueio: LocalDateTime
    --
    + getId(): Long
    + getUsuarioId(): Long
    + getConquistaId(): Long
    + getDataDesbloqueio(): LocalDateTime
}

class PecaRecompensa {
    - id: Long
    - categoriaId: Long
    - nivelRequerido: int
    --
    + getId(): Long
    + getCategoriaId(): Long
    + getNivelRequerido(): int
}

class PecaUsuario {
    - id: Long
    - usuarioId: Long
    - pecaId: Long
    - dataDesbloqueio: LocalDateTime
    --
    + getId(): Long
    + getUsuarioId(): Long
    + getPecaId(): Long
    + getDataDesbloqueio(): LocalDateTime
}

' ==========================
' RELACIONAMENTOS
' ==========================

Usuario "1" -- "0..*" Resposta : responde >
Usuario "1" -- "0..*" ProgressoCategoria : possui >
Usuario "1" -- "0..*" ConquistaUsuario : desbloqueou >
Usuario "1" -- "0..*" PecaUsuario : possui >

Categoria "1" -- "0..*" Noticia : cont√©m >
Categoria "1" -- "0..*" ProgressoCategoria : rastreia >
Categoria "1" -- "0..*" PecaRecompensa : oferece >

Noticia "1" -- "0..*" Resposta : recebe >

Conquista "1" -- "0..*" ConquistaUsuario : concedida em >

PecaRecompensa "1" -- "0..*" PecaUsuario : desbloqueada em >

' ==========================
' NOTAS EXPLICATIVAS
' ==========================

note right of Usuario
    <b>Entidade Principal</b>

    Representa o jogador:
    - N√≠vel global (1-30+)
    - Pontua√ß√£o total
    - T√≠tulo (Reporter, Analista, etc.)
    - Taxa de acerto
end note

note right of ProgressoCategoria
    <b>Maestria por Categoria</b>

    Acompanha progresso espec√≠fico
    em cada tema e controla pe√ßas
    desbloqueadas (25%, 50%, 75%, 100%)
end note

note bottom of Noticia
    <b>Conte√∫do do Jogo</b>

    Not√≠cias verificadas com:
    - Fato ou Fake (ehVerdadeira)
    - Explica√ß√£o educativa
    - Fonte confi√°vel
end note

note left of Conquista
    <b>Sistema de Conquistas</b>

    Tipos:
    - Acertos totais
    - Sequ√™ncias
    - Maestria em categorias
end note

@enduml

