@startuml VisÃ£o Geral - Fact or Fake

title Arquitetura Completa do Sistema (VisÃ£o Simplificada)

' ==========================
' CONFIGURAÃ‡Ã•ES DE ESTILO
' ==========================
skinparam packageStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam linetype ortho

' ==========================
' CAMADAS DA ARQUITETURA
' ==========================

package "ğŸŸ¢ Controller Layer\n(API REST)" <<Rectangle>> #E8F5E9 {
    [AuthController]
    [UsuarioController]
    [CategoriaController]
    [NoticiaController]
    [JogoController]
    [ConquistaController]
    [RecompensaController]
}

package "ğŸŸ¡ Service Layer\n(LÃ³gica de NegÃ³cio)" <<Rectangle>> #FFF9C4 {
    [JogoOrquestradorService]
    [NoticiaSelecaoService]
    [RespostaProcessorService]
    [ConquistaVerificadorService]
    [ProgressoCategoriaService]
    [RecompensaService]
    [UsuarioService]
    [CategoriaService]
    [NoticiaService]
    [RespostaService]
}

package "ğŸŸ£ Repository Layer\n(Acesso a Dados)" <<Rectangle>> #F3E5F5 {
    [GenericRepository<T>]
    [UsuarioRepository]
    [CategoriaRepository]
    [NoticiaRepository]
    [RespostaRepository]
    [ProgressoCategoriaRepository]
    [ConquistaRepository]
    [ConquistaUsuarioRepository]
}

package "ğŸ”µ Model Layer\n(Entidades JPA)" <<Rectangle>> #E1F5FE {
    [Usuario]
    [Categoria]
    [Noticia]
    [Resposta]
    [ProgressoCategoria]
    [Conquista]
    [ConquistaUsuario]
}

database "ğŸ—„ï¸ PostgreSQL\n(Banco de Dados)" <<Database>> {
    folder "Tabelas" {
        [usuarios]
        [categorias]
        [noticias]
        [respostas]
        [progresso_categoria]
        [conquistas]
        [conquistas_usuario]
    }
}

' ==========================
' RELACIONAMENTOS ENTRE CAMADAS
' ==========================

' Controllers â†’ Services
[AuthController] --> [UsuarioService]
[UsuarioController] --> [UsuarioService]
[UsuarioController] --> [ProgressoCategoriaService]
[UsuarioController] --> [ConquistaVerificadorService]
[CategoriaController] --> [CategoriaService]
[CategoriaController] --> [ProgressoCategoriaService]
[NoticiaController] --> [NoticiaService]
[JogoController] --> [JogoOrquestradorService]
[JogoController] --> [RespostaService]
[ConquistaController] --> [ConquistaVerificadorService]
[RecompensaController] --> [RecompensaService]

' Service Orchestration
[JogoOrquestradorService] --> [NoticiaSelecaoService]
[JogoOrquestradorService] --> [RespostaProcessorService]
[JogoOrquestradorService] --> [ProgressoCategoriaService]
[JogoOrquestradorService] --> [ConquistaVerificadorService]
[JogoOrquestradorService] --> [UsuarioService]

' Services â†’ Repositories
[UsuarioService] --> [UsuarioRepository]
[CategoriaService] --> [CategoriaRepository]
[NoticiaService] --> [NoticiaRepository]
[RespostaService] --> [RespostaRepository]
[NoticiaSelecaoService] --> [NoticiaRepository]
[NoticiaSelecaoService] --> [RespostaRepository]
[RespostaProcessorService] --> [RespostaRepository]
[RespostaProcessorService] --> [UsuarioRepository]
[ConquistaVerificadorService] --> [ConquistaRepository]
[ConquistaVerificadorService] --> [ConquistaUsuarioRepository]
[ConquistaVerificadorService] --> [UsuarioRepository]
[ProgressoCategoriaService] --> [ProgressoCategoriaRepository]
[ProgressoCategoriaService] --> [CategoriaRepository]
[ProgressoCategoriaService] --> [RespostaRepository]
[RecompensaService] --> [ProgressoCategoriaRepository]
[RecompensaService] --> [CategoriaRepository]
[RecompensaService] --> [RespostaRepository]

' Repositories â†’ Model
[UsuarioRepository] ..> [Usuario]
[CategoriaRepository] ..> [Categoria]
[NoticiaRepository] ..> [Noticia]
[RespostaRepository] ..> [Resposta]
[ProgressoCategoriaRepository] ..> [ProgressoCategoria]
[ConquistaRepository] ..> [Conquista]
[ConquistaUsuarioRepository] ..> [ConquistaUsuario]

' Model â†’ Database
[Usuario] ..> [usuarios]
[Categoria] ..> [categorias]
[Noticia] ..> [noticias]
[Resposta] ..> [respostas]
[ProgressoCategoria] ..> [progresso_categoria]
[Conquista] ..> [conquistas]
[ConquistaUsuario] ..> [conquistas_usuario]

' ==========================
' NOTAS EXPLICATIVAS
' ==========================

note top of "ğŸŸ¢ Controller Layer\n(API REST)"
    <b>Camada de ApresentaÃ§Ã£o</b>

    Define rotas HTTP REST
    Gerencia sessÃµes de usuÃ¡rio
    Valida requisiÃ§Ãµes
    Retorna JSON
end note

note top of "ğŸŸ¡ Service Layer\n(LÃ³gica de NegÃ³cio)"
    <b>LÃ³gica Central - PadrÃ£o Orquestrador</b>

    <b>JogoOrquestradorService</b> (Orquestrador):
    Coordena mÃºltiplos services especializados
    para processar uma jogada completa

    <b>Services Especializados:</b>
    - NoticiaSelecaoService: seleciona notÃ­cias
    - RespostaProcessorService: processa respostas
    - ProgressoCategoriaService: gerencia progresso
    - ConquistaVerificadorService: verifica conquistas
    - RecompensaService: calcula recompensas visuais

    <b>Services CRUD:</b>
    - UsuarioService, CategoriaService, NoticiaService
end note

note top of "ğŸŸ£ Repository Layer\n(Acesso a Dados)"
    <b>PersistÃªncia</b>

    Usa Hibernate SessionFactory
    CRUD genÃ©rico via GenericRepository<T>
    Queries especÃ­ficas por repositÃ³rio
end note

note top of "ğŸ”µ Model Layer\n(Entidades JPA)"
    <b>DomÃ­nio</b>

    Entidades mapeadas com @Entity
    Relacionamentos JPA (@ManyToOne, etc)
    Representam tabelas do banco
end note

note right of "ğŸ—„ï¸ PostgreSQL\n(Banco de Dados)"
    <b>Banco de Dados</b>

    PostgreSQL local (desenvolvimento)
    Gerenciado via Flyway migrations
    ConexÃ£o: localhost:5432
    Database: fact_or_fake
end note

' ==========================
' FLUXO DE UMA REQUISIÃ‡ÃƒO
' ==========================

note bottom of "ğŸŸ¢ Controller Layer\n(API REST)"
    <b>ğŸ“Š Fluxo de RequisiÃ§Ã£o (Exemplo: Responder NotÃ­cia)</b>

    1. <b>Frontend</b> â†’ POST /jogo/noticia/1/responder { "resposta": true }
    2. <b>JogoController</b> â†’ valida sessÃ£o via AuthController
    3. <b>JogoOrquestradorService</b> â†’ processarResposta(...)
       â”œâ”€ <b>NoticiaSelecaoService</b> â†’ busca notÃ­cia
       â”œâ”€ <b>RespostaProcessorService</b> â†’ processa resposta
       â”‚  â”œâ”€ Calcula pontos (+10 por acerto)
       â”‚  â”œâ”€ Atualiza usuÃ¡rio (nÃ­vel, taxa de acerto)
       â”‚  â””â”€ Salva resposta no banco
       â”œâ”€ <b>ProgressoCategoriaService</b> â†’ atualiza progresso
       â”‚  â””â”€ Desbloqueia peÃ§as (25%, 50%, 75%, 100%)
       â””â”€ <b>ConquistaVerificadorService</b> â†’ verifica conquistas
    4. <b>Controller</b> â†’ retorna ResultadoJogadaDTO completo
    5. <b>Frontend</b> â†’ exibe feedback + explicaÃ§Ã£o + conquistas
end note

@enduml

